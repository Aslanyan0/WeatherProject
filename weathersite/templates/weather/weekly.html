{% block content %}
{% load static %}

<!-- Подключаем CSS -->
<link rel="stylesheet" href="{% static 'css_files/weekly.css' %}" />

<div class="page">

  <!-- Header -->
  <header class="header">
    <div class="logo">
      <h1>Sunlit</h1>
      <span id="current-time"></span>
    </div>

    <nav class="nav">
      <a id="today-tab" href="/">Today</a>
      <a id="tomorrow-tab" href="/tomorrow">Tomorrow</a>
      <a id="weekly-tab" class="active" href="/weekly">Weekly Forecast</a>
    </nav>
  </header>

  <!-- Search -->
  <div class="search">
    <input id="searchInput" type="text" placeholder="Search location..." />
    <div id="suggestions" class="suggestions"></div>
  </div>

  <!-- Weekly date range -->
  <div id="weather-date" class="week-range"></div>

  <section class="forecast">
    {% for day in weekly %}
    <div class="day-card">
      <h3>{{ day.date }}</h3>

      <div class="weather-center">
        {% if day.weather.0 == "broken clouds" or day.weather.0 == "overcast clouds" %}
        <img src="{% static 'weather_icons/cloud-logo.png' %}" alt="weather">
        {% elif day.weather.0 == "clear sky" %}
        <img src="{% static 'weather_icons/sunny-logo.png' %}" alt="weather">
        {% elif day.weather.0 == "few clouds" %}
        <img src="{% static 'weather_icons/few-cloud.png' %}" alt="weather">
        {% elif day.weather.0 == "scattered clouds" %}
        <img src="{% static 'weather_icons/cloud.png' %}" alt="weather">
        {% elif day.weather.0 == "shower rain" %}
        <img src="{% static 'weather_icons/storm-rain-logo.png' %}" alt="weather">
        {% elif day.weather.0 == "rain" %}
        <img src="{% static 'weather_icons/rain-logo.png' %}" alt="weather">
        {% elif day.weather.0 == "thunderstorm" %}
        <img src="{% static 'weather_icons/storm-logo.png' %}" alt="weather">
        {% elif day.weather.0 == "snow" %}
        <img src="{% static 'weather_icons/snow-logo.png' %}" alt="weather">
        {% elif day.weather.0 == "mist" %}
        <img src="{% static 'weather_icons/mist.png' %}" alt="weather">
        {% endif %}
      </div>
      <div class="weather-temp">{{ day.temp_max }}° / {{ day.temp_min }}°</div>
    </div>
</div>
{% endfor %}
</section>

<footer>
  <div style="margin-bottom: 20px; font-size: 22px;">Sunlit</div>
  <div style="margin-top: 20px;">
    <img src="logos/instagram-logo.png" alt="Instagram" style="width:28px; margin-right:15px;">
    <img src="logos/facebook-logo.png" alt="Facebook" style="width:28px;">
  </div>
</footer>


<script>
  // ----------------------
  // Update Current Time
  // ----------------------
  function updateTime() {
    const timeElement = document.getElementById("current-time");
    const now = new Date();

    let hours = now.getHours();
    let minutes = now.getMinutes();
    minutes = minutes < 10 ? "0" + minutes : minutes;

    const ampm = hours >= 12 ? "pm" : "am";
    hours = hours % 12 || 12;

    timeElement.textContent = `${hours}:${minutes} ${ampm}`;
  }

  updateTime();
  setInterval(updateTime, 60000);

  // ----------------------
  // Load Weekly Forecast
  // ----------------------
  function loadWeeklyWeather() {
    const params = new URLSearchParams(window.location.search);
    const city = params.get("city") || "Yerevan";

    fetch(`/weekly/?city=${city}&format=json`)
      .then((res) => res.json())
      .then((data) => {
        const container = document.querySelector(".forecast");
        container.innerHTML = "";

        data.weekly.forEach((day) => {
          const card = document.createElement("div");
          card.classList.add("day-card");

          card.innerHTML = `
          <h3>${day.date}</h3>
          <img class="icon" src="${day.icon}" alt="Weather icon">
          <div class="temp">${day.temp_min}° / ${day.temp_max}°</div>
        `;

          container.appendChild(card);
        });
      })
      .catch((err) => console.error("Error loading weekly forecast:", err));
  }

  document.addEventListener("DOMContentLoaded", loadWeeklyWeather);

  // ----------------------
  // Autocomplete Search
  // ----------------------
  const input = document.getElementById("searchInput");
  const suggestions = document.getElementById("suggestions");

  input.addEventListener("input", function () {
    const query = this.value.trim();

    if (query.length < 2) {
      suggestions.innerHTML = "";
      return;
    }

    fetch(`/autocomplete?query=${encodeURIComponent(query)}`)
      .then((res) => res.json())
      .then((list) => {
        suggestions.innerHTML = "";

        list.forEach((city) => {
          const item = document.createElement("div");
          item.classList.add("suggestion-item");

          item.textContent = `${city.city}${city.region ? ", " + city.region : ""
            }, ${city.country_code}`;

          item.onclick = () => {
            input.value = city.city;
            suggestions.innerHTML = "";
            window.location.href = `/weekly?city=${city.city}`;
          };

          suggestions.appendChild(item);
        });
      });
  });

</script>
{% endblock %}
