{% block content %}
{%load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="{% static 'css_files/weekly.css' %}" />
</head>

<body>
  <div class="page">

    <!-- Header -->
    <header class="header">
      <div class="logo">
        <h1>Sunlit</h1>
        <span>21:00 pm</span>
      </div>

      <nav class="nav">
        <a>Today</a>
        <a>Tomorrow</a>
        <a class="active">Weekly Forecast</a>
      </nav>
    </header>

    <!-- Search -->
    <div class="search">
      <input type="text" placeholder="Search location..." />
    </div>

    <!-- Forecast grid -->
    <section class="forecast">
      <!-- card -->
      <div class="day-card">
        <h3>Monday</h3>
        <div class="icon sun"></div>
        <div class="temp">3°</div>
        <div class="desc">Sunny</div>
      </div>

      <div class="day-card">
        <h3>Tuesday</h3>
        <div class="icon cloud"></div>
        <div class="temp">3°</div>
        <div class="desc">Sunny</div>
      </div>

      <div class="day-card">
        <h3>Wednesday</h3>
        <div class="icon sun"></div>
        <div class="temp">3°</div>
        <div class="desc">Sunny</div>
      </div>

      <div class="day-card">
        <h3>Thursday</h3>
        <div class="icon sun"></div>
        <div class="temp">3°</div>
        <div class="desc">Sunny</div>
      </div>

      <div class="day-card">
        <h3>Friday</h3>
        <div class="icon partly"></div>
        <div class="temp">3°</div>
        <div class="desc">Sunny</div>
      </div>

      <div class="day-card">
        <h3>Saturday</h3>
        <div class="icon sun"></div>
        <div class="temp">3°</div>
        <div class="desc">Sunny</div>
      </div>

      <div class="day-card">
        <h3>Sunday</h3>
        <div class="icon storm"></div>
        <div class="temp">3°</div>
        <div class="desc">Sunny</div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-logo">Sunlit</div>
      <div class="footer-links">
        <a>Home</a>
        <a>About</a>
        <a>Contact us</a>
      </div>
    </footer>

  </div>
  <script>
    function updateTime() {
      const timeElement = document.getElementById('current-time');
      const now = new Date();
      let hours = now.getHours();
      let minutes = now.getMinutes();
      minutes = minutes < 10 ? '0' + minutes : minutes;
      const ampm = hours >= 12 ? 'pm' : 'am';
      hours = hours % 12;
      hours = hours ? hours : 12;
      timeElement.textContent = hours + ':' + minutes + ' ' + ampm;
    }

    function updateDate(offset = 0) {
      const dateElement = document.getElementById('weather-date');
      const now = new Date();
      now.setDate(now.getDate() + offset); // offset 0 = today, 1 = tomorrow

      const options = { month: 'short', day: 'numeric', weekday: 'short' };
      dateElement.textContent = now.toLocaleDateString('en-US', options);
    }

    // Обновляем сразу и каждую минуту
    updateTime();
    setInterval(updateTime, 60000);

    // По умолчанию показываем Tomorrow
    updateDate(0);

    // Переключение Today/Tomorrow
    const todayTab = document.getElementById('today-tab');
    const tomorrowTab = document.getElementById('tomorrow-tab');
    const weeklyTab = document.getElementById('weekly-tab');

    function clearActiveTabs() {
      todayTab.classList.remove('active');
      tomorrowTab.classList.remove('active');
      weeklyTab.classList.remove('active');
    }

    // Today → offset = 0
    todayTab.addEventListener('click', () => {
      clearActiveTabs();
      todayTab.classList.add('active');
      updateDate(0); // Сегодня
    });

    // Tomorrow → offset = 1
    tomorrowTab.addEventListener('click', () => {
      clearActiveTabs();
      tomorrowTab.classList.add('active');
      updateDate(1); // Завтра
    });

    // Weekly Forecast → offset = null или своя логика
    weeklyTab.addEventListener('click', () => {
      clearActiveTabs();
      weeklyTab.classList.add('active');
      const dateElement = document.getElementById('weather-date');
      // Пример: показать текущую неделю
      const now = new Date();
      const firstDay = new Date(now.setDate(now.getDate() - now.getDay()));
      const lastDay = new Date(now.setDate(now.getDate() - now.getDay() + 6));
      const options = { month: 'short', day: 'numeric' };
      dateElement.textContent = `${firstDay.toLocaleDateString('en-US', options)} - ${lastDay.toLocaleDateString('en-US', options)}`;
    });
    let timer = null;

    document.getElementById("searchInput").addEventListener("input", function () {
      const query = this.value.trim();
      const suggestions = document.getElementById("suggestions");

      if (query.length < 2) {
        suggestions.innerHTML = "";
        return;
      }

      fetch(`/autocomplete?query=${encodeURIComponent(query)}`)
        .then(res => res.json())
        .then(list => {
          suggestions.innerHTML = "";

          list.forEach(city => {
            const item = document.createElement("div");
            item.classList.add("suggestion-item");

            item.textContent = `${city.city}${city.region ? ", " + city.region : ""}, ${city.country_code}`;

            item.onclick = () => {
              document.getElementById("searchInput").value = city.city;
              suggestions.innerHTML = "";
              window.location.href = `/?city=${city.city}`;
            };

            suggestions.appendChild(item);
          });
        });
    });

  </script>

</html>
{% endblock %}
